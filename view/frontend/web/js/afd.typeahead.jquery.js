!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):e(t.$)}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function i(t,e){return t(e={exports:{}},e.exports),e.exports}function r(t){return"object"==typeof t?null!==t:"function"==typeof t}function f(t){if(!r(t))throw TypeError(t+" is not an object!");return t}function a(t){try{return!!t()}catch(t){return!0}}function n(t){return p?h.createElement(t):{}}function o(t,e){if(!r(t))return t;var i,n;if(e&&"function"==typeof(i=t.toString)&&!r(n=i.call(t)))return n;if("function"==typeof(i=t.valueOf)&&!r(n=i.call(t)))return n;if(!e&&"function"==typeof(i=t.toString)&&!r(n=i.call(t)))return n;throw TypeError("Can't convert object to primitive value")}function b(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}function l(t,e){return x.call(t,e)}function c(t){return"Symbol(".concat(void 0===t?"":t,")_",(++S+C).toString(36))}function s(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}function y(n,o,t){if(s(n),void 0===o)return n;switch(t){case 1:return function(t){return n.call(o,t)};case 2:return function(t,e){return n.call(o,t,e)};case 3:return function(t,e,i){return n.call(o,t,e,i)}}return function(){return n.apply(o,arguments)}}var g=i(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),m=i(function(t){var e=t.exports={version:"2.5.7"};"number"==typeof __e&&(__e=e)}),u=(m.version,!a(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),h=g.document,p=r(h)&&r(h.createElement),d=!u&&!a(function(){return 7!=Object.defineProperty(n("div"),"a",{get:function(){return 7}}).a}),v=Object.defineProperty,w={f:u?Object.defineProperty:function(t,e,i){if(f(t),e=o(e,!0),f(i),d)try{return v(t,e,i)}catch(t){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(t[e]=i.value),t}},k=u?function(t,e,i){return w.f(t,e,b(1,i))}:function(t,e,i){return t[e]=i,t},x={}.hasOwnProperty,S=0,C=Math.random(),O=i(function(t){var r=c("src"),e="toString",i=Function[e],s=(""+i).split(e);m.inspectSource=function(t){return i.call(t)},(t.exports=function(t,e,i,n){var o="function"==typeof i;o&&(l(i,"name")||k(i,"name",e)),t[e]!==i&&(o&&(l(i,r)||k(i,r,t[e]?""+t[e]:s.join(String(e)))),t===g?t[e]=i:n?t[e]?t[e]=i:k(t,e,i):(delete t[e],k(t,e,i)))})(Function.prototype,e,function(){return"function"==typeof this&&this[r]||i.call(this)})}),A="prototype",j=function(t,e,i){var n,o,r,s,a=t&j.F,l=t&j.G,c=t&j.S,u=t&j.P,h=t&j.B,p=l?g:c?g[e]||(g[e]={}):(g[e]||{})[A],d=l?m:m[e]||(m[e]={}),f=d[A]||(d[A]={});for(n in l&&(i=e),i)r=((o=!a&&p&&void 0!==p[n])?p:i)[n],s=h&&o?y(r,g):u&&"function"==typeof r?y(Function.call,r):r,p&&O(p,n,r,t&j.U),d[n]!=r&&k(d,n,s),u&&f[n]!=r&&(f[n]=r)};g.core=m,j.F=1,j.G=2,j.S=4,j.P=8,j.B=16,j.W=32,j.U=64,j.R=128;function L(t){return R.call(t).slice(8,-1)}function q(t){if(null==t)throw TypeError("Can't call method on  "+t);return t}function _(t){return Object(q(t))}function I(t){return isNaN(t=+t)?0:(0<t?M:G)(t)}function F(t){return 0<t?D(I(t),9007199254740991):0}function T(t,e){return new(function(t){var e;return B(t)&&("function"!=typeof(e=t.constructor)||e!==Array&&!B(e.prototype)||(e=void 0),r(e)&&null===(e=e[H])&&(e=void 0)),void 0===e?Array:e}(t))(e)}var E=j,R={}.toString,P=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==L(t)?t.split(""):Object(t)},G=Math.ceil,M=Math.floor,D=Math.min,B=Array.isArray||function(t){return"Array"==L(t)},N=i(function(t){var e="__core-js_shared__",i=g[e]||(g[e]={});(t.exports=function(t,e){return i[t]||(i[t]=void 0!==e?e:{})})("versions",[]).push({version:m.version,mode:"global",copyright:"© 2018 Denis Pushkarev (zloirock.ru)"})}),U=i(function(t){var e=N("wks"),i=g.Symbol,n="function"==typeof i;(t.exports=function(t){return e[t]||(e[t]=n&&i[t]||(n?i:c)("Symbol."+t))}).store=e}),H=U("species"),Q=U("unscopables"),V=Array.prototype;null==V[Q]&&k(V,Q,{});function J(t){V[Q][t]=!0}var z,W,K,Z,Y,X,tt,et,it,nt=(K=1==(z=5),Z=2==z,Y=3==z,X=4==z,tt=6==z,et=5==z||tt,it=W||T,function(t,e,i){for(var n,o,r=_(t),s=P(r),a=y(e,i,3),l=F(s.length),c=0,u=K?it(t,l):Z?it(t,0):void 0;c<l;c++)if((et||c in s)&&(o=a(n=s[c],c,r),z))if(K)u[c]=o;else if(o)switch(z){case 3:return!0;case 5:return n;case 6:return c;case 2:u.push(n)}else if(X)return!1;return tt?-1:Y||X?X:u}),ot="find",rt=!0;ot in[]&&Array(1)[ot](function(){rt=!1}),E(E.P+E.F*rt,"Array",{find:function(t,e){return nt(this,t,1<arguments.length?e:void 0)}}),J(ot);function st(){var t=f(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e}u&&"g"!=/./g.flags&&w.f(RegExp.prototype,"flags",{configurable:!0,get:st});function at(t){O(RegExp.prototype,lt,t,!0)}var lt="toString",ct=/./[lt];a(function(){return"/a/b"!=ct.call({source:"a",flags:"b"})})?at(function(){var t=f(this);return"/".concat(t.source,"/","flags"in t?t.flags:!u&&t instanceof RegExp?st.call(t):void 0)}):ct.name!=lt&&at(function(){return ct.call(this)});function ut(e,t,i){var n=U(e),o=i(q,n,""[e]),r=o[0],s=o[1];a(function(){var t={};return t[n]=function(){return 7},7!=""[e](t)})&&(O(String.prototype,e,r),k(RegExp.prototype,n,2==t?function(t,e){return s.call(t,this,e)}:function(t){return s.call(t,this)}))}ut("match",1,function(n,o,t){return[function(t){var e=n(this),i=null==t?void 0:t[o];return void 0!==i?i.call(t,e):new RegExp(t)[o](String(e))},t]});function ht(t){return P(q(t))}function pt(t,e){if(f(t),!r(e)&&null!==e)throw TypeError(e+": can't set as prototype!")}function dt(t){return Ct[t]||(Ct[t]=c(t))}function ft(t,e){var i,n=ht(t),o=0,r=[];for(i in n)i!=At&&l(n,i)&&r.push(i);for(;e.length>o;)l(n,i=e[o++])&&(~Ot(r,i)||r.push(i));return r}function yt(t){var e;return r(t)&&(void 0!==(e=t[_t])?!!e:"RegExp"==L(t))}function gt(t){var e=g[t];u&&e&&!e[It]&&w.f(e,It,{configurable:!0,get:function(){return this}})}var mt,vt={f:{}.propertyIsEnumerable},bt=Object.getOwnPropertyDescriptor,wt={f:u?bt:function(t,e){if(t=ht(t),e=o(e,!0),d)try{return bt(t,e)}catch(t){}if(l(t,e))return b(!vt.f.call(t,e),t[e])}},kt={set:Object.setPrototypeOf||("__proto__"in{}?function(t,i,n){try{(n=y(Function.call,wt.f(Object.prototype,"__proto__").set,2))(t,[]),i=!(t instanceof Array)}catch(t){i=!0}return function(t,e){return pt(t,e),i?t.__proto__=e:n(t,e),t}}({},!1):void 0),check:pt}.set,xt=Math.max,St=Math.min,Ct=N("keys"),Ot=(mt=!1,function(t,e,i){var n,o=ht(t),r=F(o.length),s=function(t,e){return(t=I(t))<0?xt(t+e,0):St(t,e)}(i,r);if(mt&&e!=e){for(;s<r;)if((n=o[s++])!=n)return!0}else for(;s<r;s++)if((mt||s in o)&&o[s]===e)return mt||s||0;return!mt&&-1}),At=dt("IE_PROTO"),jt="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),Lt=jt.concat("length","prototype"),qt={f:Object.getOwnPropertyNames||function(t){return ft(t,Lt)}},_t=U("match"),It=U("species"),Ft=w.f,Tt=qt.f,Et=g.RegExp,Rt=Et,Pt=Et.prototype,Gt=/a/g,Mt=/a/g,$t=new Et(Gt)!==Gt;if(u&&(!$t||a(function(){return Mt[U("match")]=!1,Et(Gt)!=Gt||Et(Mt)==Mt||"/a/i"!=Et(Gt,"i")}))){Et=function(t,e){var i=this instanceof Et,n=yt(t),o=void 0===e;return!i&&n&&t.constructor===Et&&o?t:function(t,e,i){var n,o=e.constructor;return o!==i&&"function"==typeof o&&(n=o.prototype)!==i.prototype&&r(n)&&kt&&kt(t,n),t}($t?new Rt(n&&!o?t.source:t,e):Rt((n=t instanceof Et)?t.source:t,n&&o?st.call(t):e),i?this:Pt,Et)};for(var Dt=function(e){e in Et||Ft(Et,e,{configurable:!0,get:function(){return Rt[e]},set:function(t){Rt[e]=t}})},Bt=Tt(Rt),Nt=0;Bt.length>Nt;)Dt(Bt[Nt++]);(Pt.constructor=Et).prototype=Pt,O(g,"RegExp",Et)}gt("RegExp");var Ut,Ht,Qt=[].sort,Vt=[1,2,3];E(E.P+E.F*(a(function(){Vt.sort(void 0)})||!a(function(){Vt.sort(null)})||!((Ut=Qt)&&a(function(){Ht?Ut.call(null,function(){},1):Ut.call(null)}))),"Array",{sort:function(t){return void 0===t?Qt.call(_(this)):Qt.call(_(this),s(t))}}),ut("split",2,function(o,r,s){var d=yt,f=s,y=[].push,t="split",g="length",m="lastIndex";if("c"=="abbc"[t](/(b)*/)[1]||4!="test"[t](/(?:)/,-1)[g]||2!="ab"[t](/(?:ab)*/)[g]||4!="."[t](/(.?)(.?)/)[g]||1<"."[t](/()()/)[g]||""[t](/.?/)[g]){var v=void 0===/()??/.exec("")[1];s=function(t,e){var i=String(this);if(void 0===t&&0===e)return[];if(!d(t))return f.call(i,t,e);var n,o,r,s,a,l=[],c=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),u=0,h=void 0===e?4294967295:e>>>0,p=new RegExp(t.source,c+"g");for(v||(n=new RegExp("^"+p.source+"$(?!\\s)",c));(o=p.exec(i))&&!(u<(r=o.index+o[0][g])&&(l.push(i.slice(u,o.index)),!v&&1<o[g]&&o[0].replace(n,function(){for(a=1;a<arguments[g]-2;a++)void 0===arguments[a]&&(o[a]=void 0)}),1<o[g]&&o.index<i[g]&&y.apply(l,o.slice(1)),s=o[0][g],u=r,l[g]>=h));)p[m]===o.index&&p[m]++;return u===i[g]?!s&&p.test("")||l.push(""):l.push(i.slice(u)),l[g]>h?l.slice(0,h):l}}else"0"[t](void 0,0)[g]&&(s=function(t,e){return void 0===t&&0===e?[]:f.call(this,t,e)});return[function(t,e){var i=o(this),n=null==t?void 0:t[r];return void 0!==n?n.call(t,i,e):s.call(String(i),t,e)},s]}),ut("replace",2,function(o,r,s){return[function(t,e){var i=o(this),n=null==t?void 0:t[r];return void 0!==n?n.call(t,i,e):s.call(String(i),t,e)},s]});function Jt(t,e){return{value:e,done:!!t}}function zt(){}function Wt(t,e,i){t&&!l(t=i?t:t.prototype,se)&&re(t,se,{configurable:!0,value:e})}var Kt={},Zt=Object.keys||function(t){return ft(t,jt)},Yt=u?Object.defineProperties:function(t,e){f(t);for(var i,n=Zt(e),o=n.length,r=0;r<o;)w.f(t,i=n[r++],e[i]);return t},Xt=g.document,te=Xt&&Xt.documentElement,ee=dt("IE_PROTO"),ie="prototype",ne=function(){var t,e=n("iframe"),i=jt.length;for(e.style.display="none",te.appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),ne=t.F;i--;)delete ne[ie][jt[i]];return ne()},oe=Object.create||function(t,e){var i;return null!==t?(zt[ie]=f(t),i=new zt,zt[ie]=null,i[ee]=t):i=ne(),void 0===e?i:Yt(i,e)},re=w.f,se=U("toStringTag"),ae={};k(ae,U("iterator"),function(){return this});function le(){return this}var ce=dt("IE_PROTO"),ue=Object.prototype,he=Object.getPrototypeOf||function(t){return t=_(t),l(t,ce)?t[ce]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?ue:null},pe=U("iterator"),de=!([].keys&&"next"in[].keys()),fe="values",ye=function(t,e,i,n,o,r,s){!function(t,e,i){t.prototype=oe(ae,{next:b(1,i)}),Wt(t,e+" Iterator")}(i,e,n);function a(t){if(!de&&t in f)return f[t];switch(t){case"keys":case fe:return function(){return new i(this,t)}}return function(){return new i(this,t)}}var l,c,u,h=e+" Iterator",p=o==fe,d=!1,f=t.prototype,y=f[pe]||f["@@iterator"]||o&&f[o],g=y||a(o),m=o?p?a("entries"):g:void 0,v="Array"==e&&f.entries||y;if(v&&(u=he(v.call(new t)))!==Object.prototype&&u.next&&(Wt(u,h,!0),"function"!=typeof u[pe]&&k(u,pe,le)),p&&y&&y.name!==fe&&(d=!0,g=function(){return y.call(this)}),!de&&!d&&f[pe]||k(f,pe,g),Kt[e]=g,Kt[h]=le,o)if(l={values:p?g:a(fe),keys:r?g:a("keys"),entries:m},s)for(c in l)c in f||O(f,c,l[c]);else E(E.P+E.F*(de||d),e,l);return l}(Array,"Array",function(t,e){this._t=ht(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,i=this._i++;return!t||i>=t.length?(this._t=void 0,Jt(1)):Jt(0,"keys"==e?i:"values"==e?t[i]:[i,t[i]])},"values");Kt.Arguments=Kt.Array,J("keys"),J("values"),J("entries");for(var ge=U("iterator"),me=U("toStringTag"),ve=Kt.Array,be={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},we=Zt(be),ke=0;ke<we.length;ke++){var xe,Se=we[ke],Ce=be[Se],Oe=g[Se],Ae=Oe&&Oe.prototype;if(Ae&&(Ae[ge]||k(Ae,ge,ve),Ae[me]||k(Ae,me,Se),Kt[Se]=ve,Ce))for(xe in ye)Ae[xe]||O(Ae,xe,ye[xe],!0)}var je,Le,qe,_e;je="keys",Le=function(){return function(t){return Zt(_(t))}},qe=(m.Object||{})[je]||Object[je],(_e={})[je]=Le(qe),E(E.S+E.F*a(function(){qe(1)}),"Object",_e);var Ie=i(function(e){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t){return"function"==typeof Symbol&&"symbol"===i(Symbol.iterator)?e.exports=n=function(t){return i(t)}:e.exports=n=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":i(t)},n(t)}e.exports=n});function Fe(t,e){var i={format:"json"};t.serial&&t.password?(i.serial=t.serial,i.password=t.password):t.token&&t.id?(i.token=t.token,i.id=t.id):console.error("you must either supply password and serial, or token and id"),t.defaultCountry&&(i.countryiso=t.defaultCountry),0<$("[data-afd-control='country']").length&&(i.countryiso=$("[data-afd-control='country']").val());var n=$.extend(!0,{},i,e);return{method:"GET",url:t.pceUrl,error:function(t,e,i){console.log(t),console.log(e),console.log(i),$(document).trigger("afd:pceError",t)},data:n}}function Te(i,y){var t=null,c=$(i),h=$(".afd-typeahead-container label, .afd-typeahead-field"),p=$(".afd-typeahead-container input"),d=$("[data-afd-result]"),f=$(".afd-manual-input-button"),g=$(".afd-manual-input-search-button"),m=$(".afd-search-again"),v=$(y.typeahead.fieldSets.toString()),b=y.typeahead.containers.toString(),w=0<b.length,e=Fe(y,{data:"address",fields:y.typeahead.postcodeFirst?"list":"fflist",task:"fastfindv4",lookup:"{{query}}",allpc:"1",matchPositions:y.typeahead.highlightMatches?1:0,maxquantity:y.typeahead.maxItems,uniqueid:Math.floor(9e4*Math.random())+1e4}),n=0;e.path="Item",e.beforeSend=function(t,e){var i=new URLSearchParams(e.url);t.lookup=i.get("lookup"),t.seq=n,n++,$(document).trigger("afd:pceLookupStarted",[t,i.get("lookup")])},e.callback={done:function(t,e,i){$(document).trigger("afd:pceLookupComplete",[t,i,i.lookup])}},i.on("input",function(t){$(document).trigger("afd:typeaheadInput",[t.target.value])}),i.keypress(function(){$(this).val().length<2&&(e.data.uniqueid=Math.floor(9e4*Math.random())+1e4,i.typeahead(o)),t&&window.clearTimeout(t),t=window.setTimeout(function(){$(".afd-typeahead-list").height<1&&(t=null,e.data.uniqueid=Math.floor(9e4*Math.random())+1e4,i.typeahead(o))},5e3)});var o={dynamic:!0,source:{lookup:{ajax:e}},template:"<span>{{List}}</span>",templateValue:"{{List}}",cancelButton:!1,emptyTemplate:"No results found for {{query}}",filter:!1,maxItem:0,minLength:y.typeahead.minLength,delay:20,abortAjax:!1,selector:{container:"afd-typeahead-container",result:"afd-typeahead-result",list:"afd-typeahead-list",group:"afd-typeahead-group",item:"afd-typeahead-item",empty:"afd-typeahead-empty",display:"afd-typeahead-display",query:"afd-typeahead-query",filter:"afd-typeahead-filter",filterButton:"afd-typeahead-filterButton",dropdown:"afd-typeahead-dropdown",dropdownItem:"afd-typeahead-dropdownItem",button:"afd-typeahead-button",backdrop:"afd-typeahead-backdrop",hint:"afd-typeahead-hint",cancelButton:"afd-typeahead-cancelButton"},callback:{onResult:function(t,e,i,n){y.typeahead.beforeHideResults&&y.typeahead.fewResultsManualInput&&i.length<y.typeahead.maxItems&&3<e.length&&window.Typeahead.input.result.push({List:y.typeahead.fewResultsManualInputText,Key:null,group:"lookup",matchedKey:"display"})},onShowLayout:function(t,e){var i=t.closest(b);(w?i.find(".afd-manual-input-button"):f).hide()},onHideLayout:function(t,e){var i=t.closest(b),n=w?i.find(".afd-manual-input-button"):f;!(w?0===i.find("[data-afd-result]:hidden").length:0===$("[data-afd-result]:hidden").length)&&y.typeahead.manualInputButton&&n.show()},onLayoutBuiltBefore:function(t,e,i,n){if(y.typeahead.highlightMatches)for(var o='<span class="afd-matched-highlight">',r="</span>",s=o.length+r.length,a=0;a<i.length;a++){if (typeof i[a].matchPositions === "undefined"){continue;}for(var l=i[a],c=$(n.children().eq(a)).text(),u=0;u<l.matchPositions.length;u++){var h=l.matchPositions[u],p=u*s,d="";d+=c.substr(0,h[0]+p),d+=o,d+=c.substr(h[0]+p,h[1]-h[0]),d+=r,c=d+=c.substr(h[1]+p)}var f='<a href="javascript:;">';f+=c,f+="</a>",n.children().eq(a).html(f)}return n},onSearch:function(t,e){$("."+o.selector.result).empty()},onNavigateAfter:function(t,e,i,n,o,r){if(~[38,40].indexOf(r.keyCode)){var s=t.closest(".afd-typeahead-container").find("ul.afd-typeahead-list"),a=e.filter("li.active"),l=a[0]&&a[0].offsetTop-s.height()/2||0;s.scrollTop(l)}},onClickAfter:function(t,e,i,n){var o=t.closest(b),r=w?o.find(".afd-manual-input-button"):f,s=w?o.find(".afd-manual-input-search-button"):g,a=w?o.find(".afd-search-again"):m,l=w?o.find("[data-afd-result]"):d,c=w?o.find(".afd-typeahead-container > label, .afd-typeahead-field"):h,u=w?o.find(y.typeahead.fieldSets.toString()):v;if($(".afd-typeahead-field input").val(""),!i.Key)return y.typeahead.parentClass?l.closest("."+y.typeahead.parentClass).show():l.show(),u.show(),r.hide(),s.show(),void c.hide();(function(t,e){var i=Fe(e,{key:t,data:"address",task:"retrieve",fields:e.typeahead.retrieveFields});return 1===e.afdc&&(i.data.afdc=1),$.ajax(i)})(i.Key,y).then(function(t){var e=t.Item[0];$(document).trigger("afd:pceRetrieveComplete",[e]),r.hide(),y.typeahead.afterClearTypeahead&&p.val(""),y.typeahead.afterHideTypeahead&&(c.hide(),y.typeahead.searchAgain&&a.show()),u.show(),l.length<1||l.each(function(){var t=$(this).data("afd-result");y.typeahead.pushUp?"Property"===t&&0===e.Property.length?$(this).val(e.Street):"Street"===t&&0===e.Property.length?$(this).val(""):$(this).val(e[t]):$(this).val(e[t]),!y.typeahead.hideEmpties||0<$(this).val().length?y.typeahead.parentClass?$(this).closest("."+y.typeahead.parentClass).show():$(this).show():y.typeahead.parentClass?$(this).closest("."+y.typeahead.parentClass).hide():$(this).hide(),u.show(),$(this).keyup()})})}}};$(document).on("afd:countryChanged",function(t,e){o.source.lookup.ajax.data.countryiso=e,d.val(""),i.typeahead(o)}),$(document).on("afd:initFields",function(t){i.typeahead(o),h=$(".afd-typeahead-container label, .afd-typeahead-field"),p=$(".afd-typeahead-container input"),d=$("[data-afd-result]"),f=$(".afd-manual-input-button"),g=$(".afd-manual-input-search-button"),m=$(".afd-search-again"),v=$(y.typeahead.fieldSets.toString()),b=y.typeahead.containers.toString(),w=0<b.length,function(){var t=c.closest(b),e=w?t.find(".afd-manual-input-button"):f,i=w?t.find(".afd-manual-input-search-button"):g,n=w?t.find(".afd-search-again"):m,o=w?t.find("[data-afd-result]"):d,r=w?t.find(".afd-typeahead-container > label, .afd-typeahead-field"):h,s=w?t.find(y.typeahead.fieldSets.toString()):v;r.show(),y.typeahead.manualInputButton?e.show():e.hide();if(y.typeahead.beforeHideResults){if(e.click(function(){if(e.hide(),r.hide(),i.show(),y.typeahead.parentClass?o.closest("."+y.typeahead.parentClass).show():o.show(),0<y.typeahead.fieldSets.length)for(var t=0;t<y.typeahead.fieldSets.length;t++)$(y.typeahead.fieldSets[t]).show()}),i.hide(),i.click(function(){e.show(),r.show(),i.hide(),y.typeahead.parentClass?o.closest("."+y.typeahead.parentClass).hide():o.hide(),s.hide()}),y.typeahead.parentClass?o.closest("."+y.typeahead.parentClass).hide():o.hide(),0<y.typeahead.fieldSets.length)for(var a=0;a<y.typeahead.fieldSets.length;a++)$(y.typeahead.fieldSets[a]).hide()}else if(y.typeahead.parentClass?o.closest("."+y.typeahead.parentClass).show():o.show(),0<y.typeahead.fieldSets.length)for(var l=0;l<y.typeahead.fieldSets.length;l++)$(y.typeahead.fieldSets[l]).show();if(y.typeahead.notEmptyShowResults){(w?0===t.find("[data-afd-result]:empty").filter(function(){return 0!==$.trim($(this).val()).length}).length:0===$("[data-afd-result]:empty").filter(function(){return 0!==$.trim($(this).val()).length}).length)||(y.typeahead.parentClass?o.closest("."+y.typeahead.parentClass).show():o.show(),s.show(),e.hide())}n.click(function(){o.val(""),$(this).hide(),e.show(),r.show(),y.typeahead.parentClass?o.closest("."+y.typeahead.parentClass).hide():o.hide(),s.hide()})}()}),$(document).trigger("afd:initFields")}!function(F){var i={input:null,minLength:2,maxLength:!(window.Typeahead={version:"2.10.6"}),maxItem:8,dynamic:!1,delay:300,order:null,offset:!1,hint:!1,accent:!1,highlight:!0,multiselect:null,group:!1,groupOrder:null,maxItemPerGroup:null,dropdownFilter:!1,dynamicFilter:null,backdrop:!1,backdropOnFocus:!1,cache:!1,ttl:36e5,compression:!1,searchOnFocus:!1,blurOnTab:!0,resultContainer:null,generateOnLoad:null,mustSelectItem:!1,href:null,display:["display"],template:null,templateValue:null,groupTemplate:null,correlativeTemplate:!1,emptyTemplate:!1,cancelButton:!0,loadingAnimation:!0,filter:!0,matcher:null,source:null,abortAjax:!0,callback:{onInit:null,onReady:null,onShowLayout:null,onHideLayout:null,onSearch:null,onResult:null,onLayoutBuiltBefore:null,onLayoutBuiltAfter:null,onNavigateBefore:null,onNavigateAfter:null,onEnter:null,onLeave:null,onClickBefore:null,onClickAfter:null,onDropdownFilter:null,onSendRequest:null,onReceiveRequest:null,onPopulateSource:null,onCacheSave:null,onSubmit:null,onCancel:null},selector:{container:"typeahead__container",result:"typeahead__result",list:"typeahead__list",group:"typeahead__group",item:"typeahead__item",empty:"typeahead__empty",display:"typeahead__display",query:"typeahead__query",filter:"typeahead__filter",filterButton:"typeahead__filter-button",dropdown:"typeahead__dropdown",dropdownItem:"typeahead__dropdown-item",labelContainer:"typeahead__label-container",label:"typeahead__label",button:"typeahead__button",backdrop:"typeahead__backdrop",hint:"typeahead__hint",cancelButton:"typeahead__cancel-button"},debug:!1},n={from:"ãàáäâẽèéëêìíïîõòóöôùúüûñç",to:"aaaaaeeeeeiiiiooooouuuunc"},o=~window.navigator.appVersion.indexOf("MSIE 9."),r=~window.navigator.appVersion.indexOf("MSIE 10"),s=!!~window.navigator.userAgent.indexOf("Trident")&&~window.navigator.userAgent.indexOf("rv:11"),a=0,h=0,l=function(t,e){this.rawQuery=t.val()||"",this.query=t.val()||"",this.selector=t[0].selector,this.deferred=null,this.tmpSource={},this.source={},this.dynamicGroups=[],this.hasDynamicGroups=!1,this.generatedGroupCount=0,this.groupBy="group",this.groups=[],this.searchGroups=[],this.generateGroups=[],this.requestGroups=[],this.result=[],this.tmpResult={},this.groupTemplate="",this.resultHtml=null,this.resultCount=0,this.resultCountPerGroup={},this.options=e,this.node=t,this.namespace="."+this.helper.slugify.call(this,this.selector)+".typeahead",this.isContentEditable=void 0!==this.node.attr("contenteditable")&&"false"!==this.node.attr("contenteditable"),this.container=null,this.resultContainer=null,this.item=null,this.items=null,this.comparedItems=null,this.xhr={},this.hintIndex=null,this.filters={dropdown:{},dynamic:{}},this.dropdownFilter={static:[],dynamic:[]},this.dropdownFilterAll=null,this.isDropdownEvent=!1,this.requests={},this.backdrop={},this.hint={},this.label={},this.hasDragged=!1,this.focusOnly=!1,this.displayEmptyTemplate,this.__construct()};l.prototype={_validateCacheMethod:function(t){var e;if(!0===t)t="localStorage";else if("string"==typeof t&&!~["localStorage","sessionStorage"].indexOf(t))return this.options.debug&&(T.log({node:this.selector,function:"extendOptions()",message:'Invalid options.cache, possible options are "localStorage" or "sessionStorage"'}),T.print()),!1;e=void 0!==window[t];try{window[t].setItem("typeahead","typeahead"),window[t].removeItem("typeahead")}catch(t){e=!1}return e&&t||!1},extendOptions:function(){if(this.options.cache=this._validateCacheMethod(this.options.cache),this.options.compression&&("object"===("undefined"==typeof LZString?"undefined":Ie(LZString))&&this.options.cache||(this.options.debug&&(T.log({node:this.selector,function:"extendOptions()",message:"Missing LZString Library or options.cache, no compression will occur."}),T.print()),this.options.compression=!1)),this.options.maxLength&&!isNaN(this.options.maxLength)||(this.options.maxLength=1/0),void 0!==this.options.maxItem&&~[0,!1].indexOf(this.options.maxItem)&&(this.options.maxItem=1/0),this.options.maxItemPerGroup&&!/^\d+$/.test(this.options.maxItemPerGroup)&&(this.options.maxItemPerGroup=null),this.options.display&&!Array.isArray(this.options.display)&&(this.options.display=[this.options.display]),this.options.multiselect&&(this.items=[],this.comparedItems=[],"string"==typeof this.options.multiselect.matchOn&&(this.options.multiselect.matchOn=[this.options.multiselect.matchOn])),this.options.group&&(Array.isArray(this.options.group)?this.options.debug&&(T.log({node:this.selector,function:"extendOptions()",message:"options.group must be a boolean|string|object as of 2.5.0"}),T.print()):("string"==typeof this.options.group?this.options.group={key:this.options.group}:"boolean"==typeof this.options.group&&(this.options.group={key:"group"}),this.options.group.key=this.options.group.key||"group")),this.options.highlight&&!~["any",!0].indexOf(this.options.highlight)&&(this.options.highlight=!1),this.options.dropdownFilter&&this.options.dropdownFilter instanceof Object){Array.isArray(this.options.dropdownFilter)||(this.options.dropdownFilter=[this.options.dropdownFilter]);for(var t=0,e=this.options.dropdownFilter.length;t<e;++t)this.dropdownFilter[this.options.dropdownFilter[t].value?"static":"dynamic"].push(this.options.dropdownFilter[t])}this.options.dynamicFilter&&!Array.isArray(this.options.dynamicFilter)&&(this.options.dynamicFilter=[this.options.dynamicFilter]),this.options.accent&&("object"===Ie(this.options.accent)?this.options.accent.from&&this.options.accent.to&&this.options.accent.from.length!==this.options.accent.to.length&&this.options.debug&&(T.log({node:this.selector,function:"extendOptions()",message:'Invalid "options.accent", from and to must be defined and same length.'}),T.print()):this.options.accent=n),this.options.groupTemplate&&(this.groupTemplate=this.options.groupTemplate),this.options.resultContainer&&("string"==typeof this.options.resultContainer&&(this.options.resultContainer=F(this.options.resultContainer)),this.options.resultContainer instanceof F&&this.options.resultContainer[0]?this.resultContainer=this.options.resultContainer:this.options.debug&&(T.log({node:this.selector,function:"extendOptions()",message:'Invalid jQuery selector or jQuery Object for "options.resultContainer".'}),T.print())),this.options.group&&this.options.group.key&&(this.groupBy=this.options.group.key),this.options.callback&&this.options.callback.onClick&&(this.options.callback.onClickBefore=this.options.callback.onClick,delete this.options.callback.onClick),this.options.callback&&this.options.callback.onNavigate&&(this.options.callback.onNavigateBefore=this.options.callback.onNavigate,delete this.options.callback.onNavigate),this.options=F.extend(!0,{},i,this.options)},unifySourceFormat:function(){var t,e,i;for(t in this.dynamicGroups=[],Array.isArray(this.options.source)&&(this.options.source={group:{data:this.options.source}}),"string"==typeof this.options.source&&(this.options.source={group:{ajax:{url:this.options.source}}}),this.options.source.ajax&&(this.options.source={group:{ajax:this.options.source.ajax}}),(this.options.source.url||this.options.source.data)&&(this.options.source={group:this.options.source}),this.options.source)if(this.options.source.hasOwnProperty(t)){if("string"==typeof(e=this.options.source[t])&&(e={ajax:{url:e}}),i=e.url||e.ajax,Array.isArray(i)?(e.ajax="string"==typeof i[0]?{url:i[0]}:i[0],e.ajax.path=e.ajax.path||i[1]||null):"object"===Ie(e.url)?e.ajax=e.url:"string"==typeof e.url&&(e.ajax={url:e.url}),delete e.url,!e.data&&!e.ajax)return this.options.debug&&(T.log({node:this.selector,function:"unifySourceFormat()",arguments:JSON.stringify(this.options.source),message:'Undefined "options.source.'+t+'.[data|ajax]" is Missing - Typeahead dropped'}),T.print()),!1;e.display&&!Array.isArray(e.display)&&(e.display=[e.display]),e.minLength="number"==typeof e.minLength?e.minLength:this.options.minLength,e.maxLength="number"==typeof e.maxLength?e.maxLength:this.options.maxLength,e.dynamic="boolean"==typeof e.dynamic||this.options.dynamic,e.minLength>e.maxLength&&(e.minLength=e.maxLength),this.options.source[t]=e,this.options.source[t].dynamic&&this.dynamicGroups.push(t),e.cache=void 0!==e.cache?this._validateCacheMethod(e.cache):this.options.cache,e.compression&&("object"===("undefined"==typeof LZString?"undefined":Ie(LZString))&&e.cache||(this.options.debug&&(T.log({node:this.selector,function:"unifySourceFormat()",message:"Missing LZString Library or group.cache, no compression will occur on group: "+t}),T.print()),e.compression=!1))}return this.hasDynamicGroups=this.options.dynamic||!!this.dynamicGroups.length,!0},init:function(){this.helper.executeCallback.call(this,this.options.callback.onInit,[this.node]),this.container=this.node.closest("."+this.options.selector.container),this.options.debug&&(T.log({node:this.selector,function:"init()",message:"OK - Typeahead activated on "+this.selector}),T.print())},delegateEvents:function(){var i=this,t=["focus"+this.namespace,"input"+this.namespace,"propertychange"+this.namespace,"keydown"+this.namespace,"keyup"+this.namespace,"search"+this.namespace,"generate"+this.namespace];F("html").on("touchmove",function(){i.hasDragged=!0}).on("touchstart",function(){i.hasDragged=!1}),this.node.closest("form").on("submit",function(t){if(!i.options.mustSelectItem||!i.helper.isEmpty(i.item))return i.options.backdropOnFocus||i.hideLayout(),i.options.callback.onSubmit?i.helper.executeCallback.call(i,i.options.callback.onSubmit,[i.node,this,i.item||i.items,t]):void 0;t.preventDefault()}).on("reset",function(){setTimeout(function(){i.node.trigger("input"+i.namespace),i.hideLayout()})});var n=!1;if(this.node.attr("placeholder")&&(r||s)){var e=!0;this.node.on("focusin focusout",function(){e=!(this.value||!this.placeholder)}),this.node.on("input",function(t){e&&(t.stopImmediatePropagation(),e=!1)})}this.node.off(this.namespace).on(t.join(" "),function(t,e){switch(t.type){case"generate":i.generateSource(Object.keys(i.options.source));break;case"focus":if(i.focusOnly){i.focusOnly=!1;break}i.options.backdropOnFocus&&(i.buildBackdropLayout(),i.showLayout()),i.options.searchOnFocus&&!i.item&&(i.deferred=F.Deferred(),i.assignQuery(),i.generateSource());break;case"keydown":8===t.keyCode&&i.options.multiselect&&i.options.multiselect.cancelOnBackspace&&""===i.query&&i.items.length?i.cancelMultiselectItem(i.items.length-1,null,t):t.keyCode&&~[9,13,27,38,39,40].indexOf(t.keyCode)&&(n=!0,i.navigate(t));break;case"keyup":o&&i.node[0].value.replace(/^\s+/,"").toString().length<i.query.length&&i.node.trigger("input"+i.namespace);break;case"propertychange":if(n){n=!1;break}case"input":i.deferred=F.Deferred(),i.assignQuery(),""===i.rawQuery&&""===i.query&&(t.originalEvent=e||{},i.helper.executeCallback.call(i,i.options.callback.onCancel,[i.node,i.item,t]),i.item=null),i.options.cancelButton&&i.toggleCancelButtonVisibility(),i.options.hint&&i.hint.container&&""!==i.hint.container.val()&&0!==i.hint.container.val().indexOf(i.rawQuery)&&(i.hint.container.val(""),i.isContentEditable&&i.hint.container.text("")),i.hasDynamicGroups?i.helper.typeWatch(function(){i.generateSource()},i.options.delay):i.generateSource();break;case"search":i.searchResult(),i.buildLayout(),i.result.length||i.searchGroups.length&&i.displayEmptyTemplate?i.showLayout():i.hideLayout(),i.deferred&&i.deferred.resolve()}return i.deferred&&i.deferred.promise()}),this.options.generateOnLoad&&this.node.trigger("generate"+this.namespace)},assignQuery:function(){this.isContentEditable?this.rawQuery=this.node.text():this.rawQuery=this.node.val().toString(),this.rawQuery=this.rawQuery.replace(/^\s+/,""),this.rawQuery!==this.query&&(this.query=this.rawQuery)},filterGenerateSource:function(){if(this.searchGroups=[],this.generateGroups=[],!this.focusOnly||this.options.multiselect)for(var t in this.options.source)if(this.options.source.hasOwnProperty(t)&&this.query.length>=this.options.source[t].minLength&&this.query.length<=this.options.source[t].maxLength){if(this.filters.dropdown&&"group"===this.filters.dropdown.key&&this.filters.dropdown.value!==t)continue;if(this.searchGroups.push(t),!this.options.source[t].dynamic&&this.source[t])continue;this.generateGroups.push(t)}},generateSource:function(t){if(this.filterGenerateSource(),Array.isArray(t)&&t.length)this.generateGroups=t;else if(!this.generateGroups.length)return void this.node.trigger("search"+this.namespace);if(this.requestGroups=[],this.generatedGroupCount=0,this.options.loadingAnimation&&this.container.addClass("loading"),!this.helper.isEmpty(this.xhr)){for(var e in this.xhr)this.xhr.hasOwnProperty(e)&&this.options.abortAjax&&this.xhr[e].abort();this.xhr={}}for(var i,n,o,r,s,a,l,c=this,e=0,u=this.generateGroups.length;e<u;++e){if(i=this.generateGroups[e],o=this.options.source[i],r=o.cache,s=o.compression,r&&(a=window[r].getItem("TYPEAHEAD_"+this.selector+":"+i))){s&&(a=LZString.decompressFromUTF16(a)),l=!1;try{(a=JSON.parse(a+"")).data&&a.ttl>(new Date).getTime()?(this.populateSource(a.data,i),l=!0,this.options.debug&&(T.log({node:this.selector,function:"generateSource()",message:'Source for group "'+i+'" found in '+r}),T.print())):window[r].removeItem("TYPEAHEAD_"+this.selector+":"+i)}catch(t){}if(l)continue}!o.data||o.ajax?o.ajax&&(this.requests[i]||(this.requests[i]=this.generateRequestObject(i)),this.requestGroups.push(i)):"function"==typeof o.data?(n=o.data.call(this),Array.isArray(n)?c.populateSource(n,i):"function"==typeof n.promise&&function(e){F.when(n).then(function(t){t&&Array.isArray(t)&&c.populateSource(t,e)})}(i)):this.populateSource(F.extend(!0,[],o.data),i)}return this.requestGroups.length&&this.handleRequests(),!!this.generateGroups.length},generateRequestObject:function(n){var o=this,r=this.options.source[n],t={request:{url:r.ajax.url||null,dataType:"json",beforeSend:function(t,e){o.xhr[n]=t,o.options.abortAjax||(t.seq=a,a++);var i=o.requests[n].callback.beforeSend||r.ajax.beforeSend;"function"==typeof i&&i.apply(null,arguments)}},callback:{beforeSend:null,done:null,fail:null,then:null,always:null},extra:{path:r.ajax.path||null,group:n},validForGroup:[n]};if("function"!=typeof r.ajax&&(r.ajax instanceof Object&&(t=this.extendXhrObject(t,r.ajax)),1<Object.keys(this.options.source).length))for(var e in this.requests)this.requests.hasOwnProperty(e)&&(this.requests[e].isDuplicated||t.request.url&&t.request.url===this.requests[e].request.url&&(this.requests[e].validForGroup.push(n),t.isDuplicated=!0,delete t.validForGroup));return t},extendXhrObject:function(t,e){return"object"===Ie(e.callback)&&(t.callback=e.callback,delete e.callback),"function"==typeof e.beforeSend&&(t.callback.beforeSend=e.beforeSend,delete e.beforeSend),t.request=F.extend(!0,t.request,e),"jsonp"!==t.request.dataType.toLowerCase()||t.request.jsonpCallback||(t.request.jsonpCallback="callback_"+t.extra.group),t},handleRequests:function(){var t,c=this,u=this.requestGroups.length;if(!1!==this.helper.executeCallback.call(this,this.options.callback.onSendRequest,[this.node,this.query]))for(var e=0,i=this.requestGroups.length;e<i;++e)t=this.requestGroups[e],this.requests[t].isDuplicated||function(t,s){if("function"==typeof c.options.source[t].ajax){var e=c.options.source[t].ajax.call(c,c.query);if(s=c.extendXhrObject(c.generateRequestObject(t),"object"===Ie(e)?e:{}),"object"!==Ie(s.request)||!s.request.url)return c.options.debug&&(T.log({node:c.selector,function:"handleRequests",message:'Source function must return an object containing ".url" key for group "'+t+'"'}),T.print()),c.populateSource([],t);c.requests[t]=s}var a,i=!1,l={};if(~s.request.url.indexOf("{{query}}")&&(i||(s=F.extend(!0,{},s),i=!0),s.request.url=s.request.url.replace("{{query}}",encodeURIComponent(c.query))),s.request.data)for(var n in s.request.data)if(s.request.data.hasOwnProperty(n)&&~String(s.request.data[n]).indexOf("{{query}}")){i||(s=F.extend(!0,{},s),i=!0),s.request.data[n]=s.request.data[n].replace("{{query}}",c.query);break}F.ajax(s.request).done(function(t,e,i){for(var n,o=0,r=s.validForGroup.length;o<r;o++)n=s.validForGroup[o],"function"==typeof(a=c.requests[n]).callback.done&&(l[n]=a.callback.done.call(c,t,e,i),Array.isArray(l[n])&&"object"===Ie(l[n])||c.options.debug&&(T.log({node:c.selector,function:"Ajax.callback.done()",message:"Invalid returned data has to be an Array"}),T.print()))}).fail(function(t,e,i){for(var n=0,o=s.validForGroup.length;n<o;n++)(a=c.requests[s.validForGroup[n]]).callback.fail instanceof Function&&a.callback.fail.call(c,t,e,i);c.options.debug&&(T.log({node:c.selector,function:"Ajax.callback.fail()",arguments:JSON.stringify(s.request),message:e}),console.log(i),T.print())}).always(function(t,e,i){for(var n,o=0,r=s.validForGroup.length;o<r;o++){if(n=s.validForGroup[o],(a=c.requests[n]).callback.always instanceof Function&&a.callback.always.call(c,t,e,i),"abort"===e)return;if(!c.options.abortAjax){if(i.seq<h)return;h=i.seq}c.populateSource(null!==t&&"function"==typeof t.promise&&[]||l[n]||t,a.extra.group,a.extra.path||a.request.path),0===(u-=1)&&c.helper.executeCallback.call(c,c.options.callback.onReceiveRequest,[c.node,c.query])}}).then(function(t,e){for(var i=0,n=s.validForGroup.length;i<n;i++)(a=c.requests[s.validForGroup[i]]).callback.then instanceof Function&&a.callback.then.call(c,t,e)})}(t,this.requests[t])},populateSource:function(i,t,e){var n=this,o=this.options.source[t],r=o.ajax&&o.data;e&&"string"==typeof e&&(i=this.helper.namespace.call(this,e,i)),void 0===i&&this.options.debug&&(T.log({node:this.selector,function:"populateSource()",arguments:e,message:"Invalid data path."}),T.print()),Array.isArray(i)||(this.options.debug&&(T.log({node:this.selector,function:"populateSource()",arguments:JSON.stringify({group:t}),message:"Invalid data type, must be Array type."}),T.print()),i=[]),r&&("function"==typeof r&&(r=r()),Array.isArray(r)?i=i.concat(r):this.options.debug&&(T.log({node:this.selector,function:"populateSource()",arguments:JSON.stringify(r),message:"WARNING - this.options.source."+t+".data Must be an Array or a function that returns an Array."}),T.print()));for(var s,a=o.display?"compiled"===o.display[0]?o.display[1]:o.display[0]:"compiled"===this.options.display[0]?this.options.display[1]:this.options.display[0],l=0,c=i.length;l<c;l++)null!==i[l]&&"boolean"!=typeof i[l]?("string"==typeof i[l]&&((s={})[a]=i[l],i[l]=s),i[l].group=t):this.options.debug&&(T.log({node:this.selector,function:"populateSource()",message:"WARNING - NULL/BOOLEAN value inside "+t+"! The data was skipped."}),T.print());if(!this.hasDynamicGroups&&this.dropdownFilter.dynamic.length)for(var u,h,p={},l=0,c=i.length;l<c;l++)for(var d=0,f=this.dropdownFilter.dynamic.length;d<f;d++)u=this.dropdownFilter.dynamic[d].key,(h=i[l][u])&&(this.dropdownFilter.dynamic[d].value||(this.dropdownFilter.dynamic[d].value=[]),p[u]||(p[u]=[]),~p[u].indexOf(h.toLowerCase())||(p[u].push(h.toLowerCase()),this.dropdownFilter.dynamic[d].value.push(h)));if(this.options.correlativeTemplate){var y=o.template||this.options.template,g="";if("function"==typeof y&&(y=y.call(this,"",{})),y){if(Array.isArray(this.options.correlativeTemplate))for(var l=0,c=this.options.correlativeTemplate.length;l<c;l++)g+="{{"+this.options.correlativeTemplate[l]+"}} ";else g=y.replace(/<.+?>/g," ").replace(/\s{2,}/," ").trim();for(var l=0,c=i.length;l<c;l++)i[l].compiled=F("<textarea />").html(g.replace(/\{\{([\w\-\.]+)(?:\|(\w+))?}}/g,function(t,e){return n.helper.namespace.call(n,e,i[l],"get","")}).trim()).text();o.display?~o.display.indexOf("compiled")||o.display.unshift("compiled"):~this.options.display.indexOf("compiled")||this.options.display.unshift("compiled")}else this.options.debug&&(T.log({node:this.selector,function:"populateSource()",arguments:String(t),message:"WARNING - this.options.correlativeTemplate is enabled but no template was found."}),T.print())}this.options.callback.onPopulateSource&&(i=this.helper.executeCallback.call(this,this.options.callback.onPopulateSource,[this.node,i,t,e]),this.options.debug&&(i&&Array.isArray(i)||(T.log({node:this.selector,function:"callback.populateSource()",message:'callback.onPopulateSource must return the "data" parameter'}),T.print()))),this.tmpSource[t]=Array.isArray(i)&&i||[];var m=this.options.source[t].cache,v=this.options.source[t].compression,b=this.options.source[t].ttl||this.options.ttl;if(m&&!window[m].getItem("TYPEAHEAD_"+this.selector+":"+t)){this.options.callback.onCacheSave&&(i=this.helper.executeCallback.call(this,this.options.callback.onCacheSave,[this.node,i,t,e]),this.options.debug&&(i&&Array.isArray(i)||(T.log({node:this.selector,function:"callback.populateSource()",message:'callback.onCacheSave must return the "data" parameter'}),T.print())));var w=JSON.stringify({data:i,ttl:(new Date).getTime()+b});v&&(w=LZString.compressToUTF16(w)),window[m].setItem("TYPEAHEAD_"+this.selector+":"+t,w)}this.incrementGeneratedGroup()},incrementGeneratedGroup:function(){this.generatedGroupCount++,this.options.abortAjax||(this.generatedGroupCount,this.generateGroups.length),this.xhr={};for(var t=0,e=this.generateGroups.length;t<e;t++)this.source[this.generateGroups[t]]=this.tmpSource[this.generateGroups[t]];this.hasDynamicGroups||this.buildDropdownItemLayout("dynamic"),this.options.loadingAnimation&&this.container.removeClass("loading"),this.node.trigger("search"+this.namespace)},navigate:function(t){if(this.helper.executeCallback.call(this,this.options.callback.onNavigateBefore,[this.node,this.query,t]),27===t.keyCode)return t.preventDefault(),void(this.query.length?(this.resetInput(),this.node.trigger("input"+this.namespace,[t])):(this.node.blur(),this.hideLayout()));if(this.result.length){var e=this.resultContainer.find("."+this.options.selector.item).not("[disabled]"),i=e.filter(".active"),n=i[0]?e.index(i):null,o=i[0]?i.attr("data-index"):null,r=null,s=null;if(this.clearActiveItem(),this.helper.executeCallback.call(this,this.options.callback.onLeave,[this.node,null!==n&&e.eq(n)||void 0,null!==o&&this.result[o]||void 0,t]),13===t.keyCode)return t.preventDefault(),void(0<i.length?"javascript:;"===i.find("a:first")[0].href?i.find("a:first").trigger("click",t):i.find("a:first")[0].click():this.node.closest("form").trigger("submit"));if(39!==t.keyCode){9===t.keyCode?this.options.blurOnTab?this.hideLayout():0<i.length?n+1<e.length?(t.preventDefault(),r=n+1,this.addActiveItem(e.eq(r))):this.hideLayout():e.length?(t.preventDefault(),r=0,this.addActiveItem(e.first())):this.hideLayout():38===t.keyCode?(t.preventDefault(),0<i.length?0<=n-1&&(r=n-1,this.addActiveItem(e.eq(r))):e.length&&(r=e.length-1,this.addActiveItem(e.last()))):40===t.keyCode&&(t.preventDefault(),0<i.length?n+1<e.length&&(r=n+1,this.addActiveItem(e.eq(r))):e.length&&(r=0,this.addActiveItem(e.first()))),s=null!==r?e.eq(r).attr("data-index"):null,this.helper.executeCallback.call(this,this.options.callback.onEnter,[this.node,null!==r&&e.eq(r)||void 0,null!==s&&this.result[s]||void 0,t]),t.preventInputChange&&~[38,40].indexOf(t.keyCode)&&this.buildHintLayout(null!==s&&s<this.result.length?[this.result[s]]:null),this.options.hint&&this.hint.container&&this.hint.container.css("color",t.preventInputChange?this.hint.css.color:null===s&&this.hint.css.color||this.hint.container.css("background-color")||"fff");var a=null===s||t.preventInputChange?this.rawQuery:this.getTemplateValue.call(this,this.result[s]);this.node.val(a),this.isContentEditable&&this.node.text(a),this.helper.executeCallback.call(this,this.options.callback.onNavigateAfter,[this.node,e,null!==r&&e.eq(r).find("a:first")||void 0,null!==s&&this.result[s]||void 0,this.query,t])}else null!==n?e.eq(n).find("a:first")[0].click():this.options.hint&&""!==this.hint.container.val()&&this.helper.getCaret(this.node[0])>=this.query.length&&e.filter('[data-index="'+this.hintIndex+'"]').find("a:first")[0].click()}},getTemplateValue:function(i){if(i){var t=i.group&&this.options.source[i.group].templateValue||this.options.templateValue;if("function"==typeof t&&(t=t.call(this)),!t)return this.helper.namespace.call(this,i.matchedKey,i).toString();var n=this;return t.replace(/\{\{([\w\-.]+)}}/gi,function(t,e){return n.helper.namespace.call(n,e,i,"get","")})}},clearActiveItem:function(){this.resultContainer.find("."+this.options.selector.item).removeClass("active")},addActiveItem:function(t){t.addClass("active")},searchResult:function(){this.resetLayout(),!1!==this.helper.executeCallback.call(this,this.options.callback.onSearch,[this.node,this.query])&&(!this.searchGroups.length||this.options.multiselect&&this.options.multiselect.limit&&this.items.length>=this.options.multiselect.limit||this.searchResultData(),this.helper.executeCallback.call(this,this.options.callback.onResult,[this.node,this.query,this.result,this.resultCount,this.resultCountPerGroup]),this.isDropdownEvent&&(this.helper.executeCallback.call(this,this.options.callback.onDropdownFilter,[this.node,this.query,this.filters.dropdown,this.result]),this.isDropdownEvent=!1))},searchResultData:function(){var t,e,i,n,o,r,s,a,l,c,u,h=this.groupBy,p=null,d=this.query.toLowerCase(),f=this.options.maxItem,y=this.options.maxItemPerGroup,g=this.filters.dynamic&&!this.helper.isEmpty(this.filters.dynamic),m={},v="function"==typeof this.options.matcher&&this.options.matcher;this.options.accent&&(d=this.helper.removeAccent.call(this,d));for(var b=0,w=this.searchGroups.length;b<w;++b)if(q=this.searchGroups[b],!this.filters.dropdown||"group"!==this.filters.dropdown.key||this.filters.dropdown.value===q){o=void 0!==this.options.source[q].filter?this.options.source[q].filter:this.options.filter,s="function"==typeof this.options.source[q].matcher&&this.options.source[q].matcher||v;for(var k=0,x=this.source[q].length;k<x&&(!(this.resultItemCount>=f)||this.options.callback.onResult);k++)if((!g||this.dynamicFilter.validate.apply(this,[this.source[q][k]]))&&null!==(t=this.source[q][k])&&"boolean"!=typeof t&&(!this.options.multiselect||this.isMultiselectUniqueData(t))&&(!this.filters.dropdown||(t[this.filters.dropdown.key]||"").toLowerCase()===(this.filters.dropdown.value||"").toLowerCase())){if((p="group"===h?q:t[h]?t[h]:t.group)&&!this.tmpResult[p]&&(this.tmpResult[p]=[],this.resultCountPerGroup[p]=0),y&&"group"===h&&this.tmpResult[p].length>=y&&!this.options.callback.onResult)break;L=this.options.source[q].display||this.options.display;for(var S=0,C=L.length;S<C;++S){if(!1!==o){if(void 0===(n=/\./.test(L[S])?this.helper.namespace.call(this,L[S],t):t[L[S]])||""===n){this.options.debug&&(m[S]={display:L[S],data:t});continue}n=this.helper.cleanStringFromScript(n)}if("function"==typeof o){if(void 0===(r=o.call(this,t,n)))break;if(!r)continue;"object"===Ie(r)&&(t=r)}if(~[void 0,!0].indexOf(o)){if(null===n)continue;if(i=(i=n).toString().toLowerCase(),this.options.accent&&(i=this.helper.removeAccent.call(this,i)),e=i.indexOf(d),this.options.correlativeTemplate&&"compiled"===L[S]&&e<0&&/\s/.test(d)){l=!0,c=d.split(" "),u=i;for(var O=0,A=c.length;O<A;O++)if(""!==c[O]){if(!~u.indexOf(c[O])){l=!1;break}u=u.replace(c[O],"")}}if(e<0&&!l)continue;if(this.options.offset&&0!==e)continue;if(s){if(void 0===(a=s.call(this,t,n)))break;if(!a)continue;"object"===Ie(a)&&(t=a)}}if(this.resultCount++,this.resultCountPerGroup[p]++,this.resultItemCount<f){if(y&&this.tmpResult[p].length>=y)break;this.tmpResult[p].push(F.extend(!0,{matchedKey:L[S]},t)),this.resultItemCount++}break}if(!this.options.callback.onResult){if(this.resultItemCount>=f)break;if(y&&this.tmpResult[p].length>=y&&"group"===h)break}}}if(this.options.debug&&(this.helper.isEmpty(m)||(T.log({node:this.selector,function:"searchResult()",arguments:JSON.stringify(m),message:"Missing keys for display, make sure options.display is set properly."}),T.print())),this.options.order){var j,L=[];for(var q in this.tmpResult)if(this.tmpResult.hasOwnProperty(q)){for(var b=0,w=this.tmpResult[q].length;b<w;b++)j=this.options.source[this.tmpResult[q][b].group].display||this.options.display,~L.indexOf(j[0])||L.push(j[0]);this.tmpResult[q].sort(this.helper.sort(L,"asc"===this.options.order,function(t){return t.toString().toUpperCase()}))}}var _=[],I=[];I="function"==typeof this.options.groupOrder?this.options.groupOrder.apply(this,[this.node,this.query,this.tmpResult,this.resultCount,this.resultCountPerGroup]):Array.isArray(this.options.groupOrder)?this.options.groupOrder:"string"==typeof this.options.groupOrder&&~["asc","desc"].indexOf(this.options.groupOrder)?Object.keys(this.tmpResult).sort(this.helper.sort([],"asc"===this.options.groupOrder,function(t){return t.toString().toUpperCase()})):Object.keys(this.tmpResult);for(var b=0,w=I.length;b<w;b++)_=_.concat(this.tmpResult[I[b]]||[]);this.groups=JSON.parse(JSON.stringify(I)),this.result=_},buildLayout:function(){this.buildHtmlLayout(),this.buildBackdropLayout(),this.buildHintLayout(),this.options.callback.onLayoutBuiltBefore&&(this.tmpResultHtml=this.helper.executeCallback.call(this,this.options.callback.onLayoutBuiltBefore,[this.node,this.query,this.result,this.resultHtml])),this.tmpResultHtml instanceof F?this.resultContainer.html(this.tmpResultHtml):this.resultHtml instanceof F&&this.resultContainer.html(this.resultHtml),this.options.callback.onLayoutBuiltAfter&&this.helper.executeCallback.call(this,this.options.callback.onLayoutBuiltAfter,[this.node,this.query,this.result])},buildHtmlLayout:function(){if(!1!==this.options.resultContainer){var c;if(this.resultContainer||(this.resultContainer=F("<div/>",{class:this.options.selector.result}),this.container.append(this.resultContainer)),!this.result.length)if(this.options.multiselect&&this.options.multiselect.limit&&this.items.length>=this.options.multiselect.limit)c=this.options.multiselect.limitTemplate?"function"==typeof this.options.multiselect.limitTemplate?this.options.multiselect.limitTemplate.call(this,this.query):this.options.multiselect.limitTemplate.replace(/\{\{query}}/gi,F("<div>").text(this.helper.cleanStringFromScript(this.query)).html()):"Can't select more than "+this.items.length+" items.";else{if(!this.options.emptyTemplate||""===this.query)return;c="function"==typeof this.options.emptyTemplate?this.options.emptyTemplate.call(this,this.query):this.options.emptyTemplate.replace(/\{\{query}}/gi,F("<div>").text(this.helper.cleanStringFromScript(this.query)).html())}this.displayEmptyTemplate=!!c;var o=this.query.toLowerCase();this.options.accent&&(o=this.helper.removeAccent.call(this,o));var u=this,t=this.groupTemplate||"<ul></ul>",h=!1;this.groupTemplate?t=F(t.replace(/<([^>]+)>\{\{(.+?)}}<\/[^>]+>/g,function(t,e,i,n,o){var r="",s="group"===i?u.groups:[i];if(!u.result.length)return!0===h?"":(h=!0,"<"+e+' class="'+u.options.selector.empty+'">'+c+"</"+e+">");for(var a=0,l=s.length;a<l;++a)r+="<"+e+' data-group-template="'+s[a]+'"><ul></ul></'+e+">";return r})):(t=F(t),this.result.length||t.append(c instanceof F?c:'<li class="'+u.options.selector.empty+'">'+c+"</li>")),t.addClass(this.options.selector.list+(this.helper.isEmpty(this.result)?" empty":""));for(var e,i,r,n,s,a,l,p,d,f,y,g=this.groupTemplate&&this.result.length&&u.groups||[],m=0,v=this.result.length;m<v;++m)r=this.result[m],e=r.group,n=!this.options.multiselect&&this.options.source[r.group].href||this.options.href,p=[],d=this.options.source[r.group].display||this.options.display,this.options.group&&(e=r[this.options.group.key],this.options.group.template&&("function"==typeof this.options.group.template?i=this.options.group.template.call(this,r):"string"==typeof this.options.group.template&&(i=this.options.group.template.replace(/\{\{([\w\-\.]+)}}/gi,function(t,e){return u.helper.namespace.call(u,e,r,"get","")}))),t.find('[data-search-group="'+e+'"]')[0]||(this.groupTemplate?t.find('[data-group-template="'+e+'"] ul'):t).append(F("<li/>",{class:u.options.selector.group,html:F("<a/>",{href:"javascript:;",html:i||e,tabindex:-1}),"data-search-group":e}))),this.groupTemplate&&g.length&&~(y=g.indexOf(e||r.group))&&g.splice(y,1),s=F("<li/>",{class:u.options.selector.item+" "+u.options.selector.group+"-"+this.helper.slugify.call(this,e),disabled:!!r.disabled,"data-group":e,"data-index":m,html:F("<a/>",{href:n&&!r.disabled?function(t,e){return e.href=u.generateHref.call(u,t,e)}(n,r):"javascript:;",html:function(){if(a=r.group&&u.options.source[r.group].template||u.options.template)"function"==typeof a&&(a=a.call(u,u.query,r)),l=a.replace(/\{\{([^\|}]+)(?:\|([^}]+))*}}/gi,function(t,e,i){var n=u.helper.cleanStringFromScript(String(u.helper.namespace.call(u,e,r,"get","")));return~(i=i&&i.split("|")||[]).indexOf("slugify")&&(n=u.helper.slugify.call(u,n)),~i.indexOf("raw")||!0===u.options.highlight&&o&&~d.indexOf(e)&&(n=u.helper.highlight.call(u,n,o.split(" "),u.options.accent)),n});else{for(var t=0,e=d.length;t<e;t++)void 0!==(f=/\./.test(d[t])?u.helper.namespace.call(u,d[t],r,"get",""):r[d[t]])&&""!==f&&p.push(f);l='<span class="'+u.options.selector.display+'">'+u.helper.cleanStringFromScript(String(p.join(" ")))+"</span>"}(!0===u.options.highlight&&o&&!a||"any"===u.options.highlight)&&(l=u.helper.highlight.call(u,l,o.split(" "),u.options.accent)),F(this).append(l)}})}),function(t,i,e){e.on("click",function(t,e){i.disabled?t.preventDefault():(e&&"object"===Ie(e)&&(t.originalEvent=e),u.options.mustSelectItem&&u.helper.isEmpty(i)?t.preventDefault():(u.options.multiselect||(u.item=i),!1!==u.helper.executeCallback.call(u,u.options.callback.onClickBefore,[u.node,F(this),i,t])&&(t.originalEvent&&t.originalEvent.defaultPrevented||t.isDefaultPrevented()||(u.options.multiselect?(u.query=u.rawQuery="",u.addMultiselectItemLayout(i)):(u.focusOnly=!0,u.query=u.rawQuery=u.getTemplateValue.call(u,i),u.isContentEditable&&(u.node.text(u.query),u.helper.setCaretAtEnd(u.node[0]))),u.hideLayout(),u.node.val(u.query).focus(),u.options.cancelButton&&u.toggleCancelButtonVisibility(),u.helper.executeCallback.call(u,u.options.callback.onClickAfter,[u.node,F(this),i,t])))))}),e.on("mouseenter",function(t){i.disabled||(u.clearActiveItem(),u.addActiveItem(F(this))),u.helper.executeCallback.call(u,u.options.callback.onEnter,[u.node,F(this),i,t])}),e.on("mouseleave",function(t){i.disabled||u.clearActiveItem(),u.helper.executeCallback.call(u,u.options.callback.onLeave,[u.node,F(this),i,t])})}(0,r,s),(this.groupTemplate?t.find('[data-group-template="'+e+'"] ul'):t).append(s);if(this.result.length&&g.length)for(var m=0,v=g.length;m<v;++m)t.find('[data-group-template="'+g[m]+'"]').remove();this.resultHtml=t}},generateHref:function(t,o){var r=this;return"string"==typeof t?t=t.replace(/\{\{([^\|}]+)(?:\|([^}]+))*}}/gi,function(t,e,i){var n=r.helper.namespace.call(r,e,o,"get","");return~(i=i&&i.split("|")||[]).indexOf("slugify")&&(n=r.helper.slugify.call(r,n)),n}):"function"==typeof t&&(t=t.call(this,o)),t},getMultiselectComparedData:function(t){var e="";if(Array.isArray(this.options.multiselect.matchOn))for(var i=0,n=this.options.multiselect.matchOn.length;i<n;++i)e+=void 0!==t[this.options.multiselect.matchOn[i]]?t[this.options.multiselect.matchOn[i]]:"";else{for(var o=JSON.parse(JSON.stringify(t)),r=["group","matchedKey","compiled","href"],i=0,n=r.length;i<n;++i)delete o[r[i]];e=JSON.stringify(o)}return e},buildBackdropLayout:function(){this.options.backdrop&&(this.backdrop.container||(this.backdrop.css=F.extend({opacity:.6,filter:"alpha(opacity=60)",position:"fixed",top:0,right:0,bottom:0,left:0,"z-index":1040,"background-color":"#000"},this.options.backdrop),this.backdrop.container=F("<div/>",{class:this.options.selector.backdrop,css:this.backdrop.css}).insertAfter(this.container)),this.container.addClass("backdrop").css({"z-index":this.backdrop.css["z-index"]+1,position:"relative"}))},buildHintLayout:function(t){if(this.options.hint)if(this.node[0].scrollWidth>Math.ceil(this.node.innerWidth()))this.hint.container&&this.hint.container.val("");else{var e=this,i="",t=t||this.result,n=this.query.toLowerCase();if(this.options.accent&&(n=this.helper.removeAccent.call(this,n)),this.hintIndex=null,this.searchGroups.length){if(this.hint.container||(this.hint.css=F.extend({"border-color":"transparent",position:"absolute",top:0,display:"inline","z-index":-1,float:"none",color:"silver","box-shadow":"none",cursor:"default","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"},this.options.hint),this.hint.container=F("<"+this.node[0].nodeName+"/>",{type:this.node.attr("type"),class:this.node.attr("class"),readonly:!0,unselectable:"on","aria-hidden":"true",tabindex:-1,click:function(){e.node.focus()}}).addClass(this.options.selector.hint).css(this.hint.css).insertAfter(this.node),this.node.parent().css({position:"relative"})),this.hint.container.css("color",this.hint.css.color),n)for(var o,r,s,a=0,l=t.length;a<l;a++)if(!t[a].disabled){r=t[a].group,o=this.options.source[r].display||this.options.display;for(var c=0,u=o.length;c<u;c++)if(s=String(t[a][o[c]]).toLowerCase(),this.options.accent&&(s=this.helper.removeAccent.call(this,s)),0===s.indexOf(n)){i=String(t[a][o[c]]),this.hintIndex=a;break}if(null!==this.hintIndex)break}var h=0<i.length&&this.rawQuery+i.substring(this.query.length)||"";this.hint.container.val(h),this.isContentEditable&&this.hint.container.text(h)}}},buildDropdownLayout:function(){if(this.options.dropdownFilter){var i=this;F("<span/>",{class:this.options.selector.filter,html:function(){F(this).append(F("<button/>",{type:"button",class:i.options.selector.filterButton,style:"display: none;",click:function(){i.container.toggleClass("filter");var e=i.namespace+"-dropdown-filter";F("html").off(e),i.container.hasClass("filter")&&F("html").on("click"+e+" touchend"+e,function(t){F(t.target).closest("."+i.options.selector.filter)[0]&&F(t.target).closest(i.container)[0]||i.hasDragged||(i.container.removeClass("filter"),F("html").off(e))})}})),F(this).append(F("<ul/>",{class:i.options.selector.dropdown}))}}).insertAfter(i.container.find("."+i.options.selector.query))}},buildDropdownItemLayout:function(t){if(this.options.dropdownFilter){var e,i,o=this,r="string"==typeof this.options.dropdownFilter&&this.options.dropdownFilter||"All",s=this.container.find("."+this.options.selector.dropdown);"static"!==t||!0!==this.options.dropdownFilter&&"string"!=typeof this.options.dropdownFilter||this.dropdownFilter.static.push({key:"group",template:"{{group}}",all:r,value:Object.keys(this.options.source)});for(var n=0,a=this.dropdownFilter[t].length;n<a;n++){i=this.dropdownFilter[t][n],Array.isArray(i.value)||(i.value=[i.value]),i.all&&(this.dropdownFilterAll=i.all);for(var l=0,c=i.value.length;l<=c;l++)l===c&&n!==a-1||l===c&&n===a-1&&"static"===t&&this.dropdownFilter.dynamic.length||(e=this.dropdownFilterAll||r,i.value[l]?e=i.template?i.template.replace(new RegExp("{{"+i.key+"}}","gi"),i.value[l]):i.value[l]:this.container.find("."+o.options.selector.filterButton).html(e),function(e,i,n){s.append(F("<li/>",{class:o.options.selector.dropdownItem+" "+o.helper.slugify.call(o,i.key+"-"+(i.value[e]||r)),html:F("<a/>",{href:"javascript:;",html:n,click:function(t){t.preventDefault(),u.call(o,{key:i.key,value:i.value[e]||"*",template:n})}})}))}(l,i,e))}this.dropdownFilter[t].length&&this.container.find("."+o.options.selector.filterButton).removeAttr("style")}function u(t){"*"===t.value?delete this.filters.dropdown:this.filters.dropdown=t,this.container.removeClass("filter").find("."+this.options.selector.filterButton).html(t.template),this.isDropdownEvent=!0,this.node.trigger("input"+this.namespace),this.options.multiselect&&this.adjustInputSize(),this.node.focus()}},dynamicFilter:{isEnabled:!1,init:function(){this.options.dynamicFilter&&(this.dynamicFilter.bind.call(this),this.dynamicFilter.isEnabled=!0)},validate:function(t){var e,i,n=null,o=null;for(var r in this.filters.dynamic)if(this.filters.dynamic.hasOwnProperty(r)&&(i=~r.indexOf(".")?this.helper.namespace.call(this,r,t,"get"):t[r],"|"!==this.filters.dynamic[r].modifier||n||(n=i==this.filters.dynamic[r].value||!1),"&"===this.filters.dynamic[r].modifier)){if(i!=this.filters.dynamic[r].value){o=!1;break}o=!0}return e=n,null!==o&&!0===(e=o)&&null!==n&&(e=n),!!e},set:function(t,e){var i=t.match(/^([|&])?(.+)/);e?this.filters.dynamic[i[2]]={modifier:i[1]||"|",value:e}:delete this.filters.dynamic[i[2]],this.dynamicFilter.isEnabled&&this.generateSource()},bind:function(){for(var t,e=this,i=0,n=this.options.dynamicFilter.length;i<n;i++)"string"==typeof(t=this.options.dynamicFilter[i]).selector&&(t.selector=F(t.selector)),t.selector instanceof F&&t.selector[0]&&t.key?function(t){t.selector.off(e.namespace).on("change"+e.namespace,function(){e.dynamicFilter.set.apply(e,[t.key,e.dynamicFilter.getValue(this)])}).trigger("change"+e.namespace)}(t):this.options.debug&&(T.log({node:this.selector,function:"buildDynamicLayout()",message:'Invalid jQuery selector or jQuery Object for "filter.selector" or missing filter.key'}),T.print())},getValue:function(t){var e;return"SELECT"===t.tagName?e=t.value:"INPUT"===t.tagName&&("checkbox"===t.type?e=t.checked&&t.getAttribute("value")||t.checked||null:"radio"===t.type&&t.checked&&(e=t.value)),e}},buildMultiselectLayout:function(){if(this.options.multiselect){var t,e=this;this.label.container=F("<span/>",{class:this.options.selector.labelContainer,"data-padding-left":parseFloat(this.node.css("padding-left"))||0,"data-padding-right":parseFloat(this.node.css("padding-right"))||0,"data-padding-top":parseFloat(this.node.css("padding-top"))||0,click:function(t){F(t.target).hasClass(e.options.selector.labelContainer)&&e.node.focus()}}),this.node.closest("."+this.options.selector.query).prepend(this.label.container),this.options.multiselect.data&&(Array.isArray(this.options.multiselect.data)?this.populateMultiselectData(this.options.multiselect.data):"function"==typeof this.options.multiselect.data&&(t=this.options.multiselect.data.call(this),Array.isArray(t)?this.populateMultiselectData(t):"function"==typeof t.promise&&F.when(t).then(function(t){t&&Array.isArray(t)&&e.populateMultiselectData(t)})))}},isMultiselectUniqueData:function(t){for(var e=!0,i=0,n=this.comparedItems.length;i<n;++i)if(this.comparedItems[i]===this.getMultiselectComparedData(t)){e=!1;break}return e},populateMultiselectData:function(t){for(var e=0,i=t.length;e<i;++e)this.addMultiselectItemLayout(t[e]);this.node.trigger("search"+this.namespace,{origin:"populateMultiselectData"})},addMultiselectItemLayout:function(t){if(this.isMultiselectUniqueData(t)){this.items.push(t),this.comparedItems.push(this.getMultiselectComparedData(t));var e=this.getTemplateValue(t),n=this,i=this.options.multiselect.href?"a":"span",o=F("<span/>",{class:this.options.selector.label,html:F("<"+i+"/>",{text:e,click:function(t){var e=F(this).closest("."+n.options.selector.label),i=n.label.container.find("."+n.options.selector.label).index(e);n.options.multiselect.callback&&n.helper.executeCallback.call(n,n.options.multiselect.callback.onClick,[n.node,n.items[i],t])},href:this.options.multiselect.href?function(t){return n.generateHref.call(n,n.options.multiselect.href,t)}(n.items[n.items.length-1]):null})});return o.append(F("<span/>",{class:this.options.selector.cancelButton,html:"×",click:function(t){var e=F(this).closest("."+n.options.selector.label),i=n.label.container.find("."+n.options.selector.label).index(e);n.cancelMultiselectItem(i,e,t)}})),this.label.container.append(o),this.adjustInputSize(),!0}},cancelMultiselectItem:function(t,e,i){var n=this.items[t];(e=e||this.label.container.find("."+this.options.selector.label).eq(t)).remove(),this.items.splice(t,1),this.comparedItems.splice(t,1),this.options.multiselect.callback&&this.helper.executeCallback.call(this,this.options.multiselect.callback.onCancel,[this.node,n,i]),this.adjustInputSize(),this.focusOnly=!0,this.node.focus().trigger("input"+this.namespace,{origin:"cancelMultiselectItem"})},adjustInputSize:function(){var i=this.node[0].getBoundingClientRect().width-(parseFloat(this.label.container.data("padding-right"))||0)-(parseFloat(this.label.container.css("padding-left"))||0),n=0,o=0,r=0,s=!1,a=0;this.label.container.find("."+this.options.selector.label).filter(function(t,e){0===t&&(a=F(e)[0].getBoundingClientRect().height+parseFloat(F(e).css("margin-bottom")||0)),n=F(e)[0].getBoundingClientRect().width+parseFloat(F(e).css("margin-right")||0),.7*i<r+n&&!s&&(o++,s=!0),r+n<i?r+=n:(s=!1,r=n)});var t=parseFloat(this.label.container.data("padding-left")||0)+(s?0:r),e=o*a+parseFloat(this.label.container.data("padding-top")||0);this.container.find("."+this.options.selector.query).find("input, textarea, [contenteditable], .typeahead__hint").css({paddingLeft:t,paddingTop:e})},showLayout:function(){!this.container.hasClass("result")&&(this.result.length||this.displayEmptyTemplate||this.options.backdropOnFocus)&&(function(){var e=this;F("html").off("keydown"+this.namespace).on("keydown"+this.namespace,function(t){t.keyCode&&9===t.keyCode&&setTimeout(function(){F(":focus").closest(e.container).find(e.node)[0]||e.hideLayout()},0)}),F("html").off("click"+this.namespace+" touchend"+this.namespace).on("click"+this.namespace+" touchend"+this.namespace,function(t){F(t.target).closest(e.container)[0]||F(t.target).closest("."+e.options.selector.item)[0]||t.target.className===e.options.selector.cancelButton||e.hasDragged||e.hideLayout()})}.call(this),this.container.addClass([this.result.length||this.searchGroups.length&&this.displayEmptyTemplate?"result ":"",this.options.hint&&this.searchGroups.length?"hint":"",this.options.backdrop||this.options.backdropOnFocus?"backdrop":""].join(" ")),this.helper.executeCallback.call(this,this.options.callback.onShowLayout,[this.node,this.query]))},hideLayout:function(){(this.container.hasClass("result")||this.container.hasClass("backdrop"))&&(this.container.removeClass("result hint filter"+(this.options.backdropOnFocus&&F(this.node).is(":focus")?"":" backdrop")),this.options.backdropOnFocus&&this.container.hasClass("backdrop")||(F("html").off(this.namespace),this.helper.executeCallback.call(this,this.options.callback.onHideLayout,[this.node,this.query])))},resetLayout:function(){this.result=[],this.tmpResult={},this.groups=[],this.resultCount=0,this.resultCountPerGroup={},this.resultItemCount=0,this.resultHtml=null,this.options.hint&&this.hint.container&&(this.hint.container.val(""),this.isContentEditable&&this.hint.container.text(""))},resetInput:function(){this.node.val(""),this.isContentEditable&&this.node.text(""),this.query="",this.rawQuery=""},buildCancelButtonLayout:function(){if(this.options.cancelButton){var e=this;F("<span/>",{class:this.options.selector.cancelButton,html:"×",mousedown:function(t){t.stopImmediatePropagation(),t.preventDefault(),e.resetInput(),e.node.trigger("input"+e.namespace,[t])}}).insertBefore(this.node)}},toggleCancelButtonVisibility:function(){this.container.toggleClass("cancel",!!this.query.length)},__construct:function(){this.extendOptions(),this.unifySourceFormat()&&(this.dynamicFilter.init.apply(this),this.init(),this.buildDropdownLayout(),this.buildDropdownItemLayout("static"),this.buildMultiselectLayout(),this.delegateEvents(),this.buildCancelButtonLayout(),this.helper.executeCallback.call(this,this.options.callback.onReady,[this.node]))},helper:{isEmpty:function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},removeAccent:function(t){if("string"==typeof t){var e=n;return"object"===Ie(this.options.accent)&&(e=this.options.accent),t=t.toLowerCase().replace(new RegExp("["+e.from+"]","g"),function(t){return e.to[e.from.indexOf(t)]})}},slugify:function(t){return""!==(t=String(t))&&(t=(t=this.helper.removeAccent.call(this,t)).replace(/[^-a-z0-9]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")),t},sort:function(n,i,o){var r=function(t){for(var e=0,i=n.length;e<i;e++)if(void 0!==t[n[e]])return o(t[n[e]]);return t};return i=[-1,1][+!!i],function(t,e){return t=r(t),e=r(e),i*((e<t)-(t<e))}},replaceAt:function(t,e,i,n){return t.substring(0,e)+n+t.substring(e+i)},highlight:function(t,e,i){t=String(t);var n=i&&this.helper.removeAccent.call(this,t)||t,o=[];Array.isArray(e)||(e=[e]),e.sort(function(t,e){return e.length-t.length});for(var r=e.length-1;0<=r;r--)""!==e[r].trim()?e[r]=e[r].replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):e.splice(r,1);n.replace(new RegExp("(?:"+e.join("|")+")(?!([^<]+)?>)","gi"),function(t,e,i){o.push({offset:i,length:t.length})});for(var r=o.length-1;0<=r;r--)t=this.helper.replaceAt(t,o[r].offset,o[r].length,"<strong>"+t.substr(o[r].offset,o[r].length)+"</strong>");return t},getCaret:function(t){var e=0;if(t.selectionStart)return t.selectionStart;if(document.selection){var i=document.selection.createRange();if(null===i)return e;var n=t.createTextRange(),o=n.duplicate();n.moveToBookmark(i.getBookmark()),o.setEndPoint("EndToStart",n),e=o.text.length}else if(window.getSelection){var r=window.getSelection();if(r.rangeCount){var s=r.getRangeAt(0);s.commonAncestorContainer.parentNode==t&&(e=s.endOffset)}}return e},setCaretAtEnd:function(t){if(void 0!==window.getSelection&&void 0!==document.createRange){var e=document.createRange();e.selectNodeContents(t),e.collapse(!1);var i=window.getSelection();i.removeAllRanges(),i.addRange(e)}else if(void 0!==document.body.createTextRange){var n=document.body.createTextRange();n.moveToElementText(t),n.collapse(!1),n.select()}},cleanStringFromScript:function(t){return"string"==typeof t&&t.replace(/<\/?(?:script|iframe)\b[^>]*>/gm,"")||t},executeCallback:function(t,e){if(t){var i;if("function"==typeof t)i=t;else if(("string"==typeof t||Array.isArray(t))&&("string"==typeof t&&(t=[t,[]]),"function"!=typeof(i=this.helper.namespace.call(this,t[0],window))))return void(this.options.debug&&(T.log({node:this.selector,function:"executeCallback()",arguments:JSON.stringify(t),message:'WARNING - Invalid callback function"'}),T.print()));return i.apply(this,(t[1]||[]).concat(e||[]))}},namespace:function(t,e,i,n){if("string"!=typeof t||""===t)return this.options.debug&&(T.log({node:this.options.input||this.selector,function:"helper.namespace()",arguments:t,message:'ERROR - Missing string"'}),T.print()),!1;var o=void 0!==n?n:void 0;if(!~t.indexOf("."))return e[t]||o;for(var r=t.split("."),s=e||window,i=i||"get",a="",l=0,c=r.length;l<c;l++){if(a=r[l],void 0===s[a]){if(~["get","delete"].indexOf(i))return void 0!==n?n:void 0;s[a]={}}if(~["set","create","delete"].indexOf(i)&&l===c-1){if("set"!==i&&"create"!==i)return delete s[a],!0;s[a]=o}s=s[a]}return s},typeWatch:function(){var i=0;return function(t,e){clearTimeout(i),i=setTimeout(t,e)}}()}},F.fn.typeahead=F.typeahead=function(t){return e.typeahead(this,t)};var e={typeahead:function(t,e){if(!e||!e.source||"object"!==Ie(e.source))return T.log({node:t.selector||e&&e.input,function:"$.typeahead()",arguments:JSON.stringify(e&&e.source||""),message:'Undefined "options" or "options.source" or invalid source type - Typeahead dropped'}),void T.print();if("function"==typeof t){if(!e.input)return T.log({node:t.selector,function:"$.typeahead()",message:'Undefined "options.input" - Typeahead dropped'}),void T.print();t=F(e.input)}if(void 0===t[0].value&&(t[0].value=t.text()),!t.length)return T.log({node:t.selector,function:"$.typeahead()",arguments:JSON.stringify(e.input),message:"Unable to find jQuery input element - Typeahead dropped"}),void T.print();if(1===t.length)return t[0].selector=t.selector||e.input||t[0].nodeName.toLowerCase(),window.Typeahead[t[0].selector]=new l(t,e);for(var i,n={},o=0,r=t.length;o<r;++o)i=t[o].nodeName.toLowerCase(),void 0!==n[i]&&(i+=o),t[o].selector=i,window.Typeahead[i]=n[i]=new l(t.eq(o),e);return n}},T={table:{},log:function(t){t.message&&"string"==typeof t.message&&(this.table[t.message]=F.extend({node:"",function:"",arguments:""},t))},print:function(){!l.prototype.helper.isEmpty(this.table)&&console&&console.table&&(void 0!==console.group||console.table,this.table={})}};T.log({message:"WARNING - You are using the DEBUG version. Use /dist/jquery.typeahead.min.js in production."}),T.print(),window.console=window.console||{log:function(){}},Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}),"indexOf"in Array.prototype||(Array.prototype.indexOf=function(t,e){void 0===e&&(e=0),e<0&&(e+=this.length),e<0&&(e=0);for(var i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1}),Object.keys||(Object.keys=function(t){var e,i=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&i.push(e);return i})}(jQuery),function(i){var t,e=i.URLSearchParams&&i.URLSearchParams.prototype.get?i.URLSearchParams:null,n=e&&"a=1"===new e({a:1}).toString(),o=e&&"+"===new e("s=%2B").get("s"),s="__URLSearchParams__",r=!e||((t=new e).append("s"," &"),"s=+%26"===t.toString()),a=h.prototype,l=!(!i.Symbol||!i.Symbol.iterator);if(!(e&&n&&o&&r)){a.append=function(t,e){g(this[s],t,e)},a.delete=function(t){delete this[s][t]},a.get=function(t){var e=this[s];return t in e?e[t][0]:null},a.getAll=function(t){var e=this[s];return t in e?e[t].slice(0):[]},a.has=function(t){return t in this[s]},a.set=function(t,e){this[s][t]=[""+e]},a.toString=function(){var t,e,i,n,o=this[s],r=[];for(e in o)for(i=p(e),t=0,n=o[e];t<n.length;t++)r.push(i+"="+p(n[t]));return r.join("&")};var c=!!o&&e&&!n&&i.Proxy;Object.defineProperty(i,"URLSearchParams",{value:c?new Proxy(e,{construct:function(t,e){return new t(new h(e[0]).toString())}}):h});var u=i.URLSearchParams.prototype;u.polyfill=!0,u.forEach=u.forEach||function(i,n){var t=y(this.toString());Object.getOwnPropertyNames(t).forEach(function(e){t[e].forEach(function(t){i.call(n,t,e,this)},this)},this)},u.sort=u.sort||function(){var t,e,i,n=y(this.toString()),o=[];for(t in n)o.push(t);for(o.sort(),e=0;e<o.length;e++)this.delete(o[e]);for(e=0;e<o.length;e++){var r=o[e],s=n[r];for(i=0;i<s.length;i++)this.append(r,s[i])}},u.keys=u.keys||function(){var i=[];return this.forEach(function(t,e){i.push(e)}),f(i)},u.values=u.values||function(){var e=[];return this.forEach(function(t){e.push(t)}),f(e)},u.entries=u.entries||function(){var i=[];return this.forEach(function(t,e){i.push([e,t])}),f(i)},l&&(u[i.Symbol.iterator]=u[i.Symbol.iterator]||u.entries)}function h(t){((t=t||"")instanceof URLSearchParams||t instanceof h)&&(t=t.toString()),this[s]=y(t)}function p(t){var e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'\(\)~]|%20|%00/g,function(t){return e[t]})}function d(t){return t.replace(/[ +]/g,"%20").replace(/(%[a-f0-9]{2})+/gi,function(t){return decodeURIComponent(t)})}function f(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return l&&(t[i.Symbol.iterator]=function(){return t}),t}function y(t){var e={};if("object"==typeof t)if(m(t))for(var i=0;i<t.length;i++){var n=t[i];if(!m(n)||2!==n.length)throw new TypeError("Failed to construct 'URLSearchParams': Sequence initializer must only contain pair elements");g(e,n[0],n[1])}else for(var o in t)t.hasOwnProperty(o)&&g(e,o,t[o]);else{0===t.indexOf("?")&&(t=t.slice(1));for(var r=t.split("&"),s=0;s<r.length;s++){var a=r[s],l=a.indexOf("=");-1<l?g(e,d(a.slice(0,l)),d(a.slice(l+1))):a&&g(e,d(a),"")}}return e}function g(t,e,i){var n="string"==typeof i?i:null!=i&&"function"==typeof i.toString?i.toString():JSON.stringify(i);e in t?t[e].push(n):t[e]=[n]}function m(t){return!!t&&"[object Array]"===Object.prototype.toString.call(t)}}(void 0!==e?e:"undefined"!=typeof window?window:e);var Ee=w.f,Re=Function.prototype,Pe=/^\s*function ([^ (]*)/;"name"in Re||u&&Ee(Re,"name",{configurable:!0,get:function(){try{return(""+this).match(Pe)[1]}catch(t){return""}}});function Ge(t){var e,i,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),He))?i:Qe?L(e):"Object"==(n=L(e))&&"function"==typeof e.callee?"Arguments":n}function Me(e,t,i,n){try{return n?t(f(i)[0],i[1]):t(i)}catch(t){var o=e.return;throw void 0!==o&&f(o.call(e)),t}}function $e(){var t=+this;if(oi.hasOwnProperty(t)){var e=oi[t];delete oi[t],e()}}function De(t){$e.call(t.data)}var Be,Ne,Ue,He=U("toStringTag"),Qe="Arguments"==L(function(){return arguments}()),Ve=U("iterator"),Je=Array.prototype,ze=U("iterator"),We=m.getIteratorMethod=function(t){if(null!=t)return t[ze]||t["@@iterator"]||Kt[Ge(t)]},Ke=i(function(t){var p={},d={},e=t.exports=function(t,e,i,n,o){var r,s,a,l,c=o?function(){return t}:We(t),u=y(i,n,e?2:1),h=0;if("function"!=typeof c)throw TypeError(t+" is not iterable!");if(function(t){return void 0!==t&&(Kt.Array===t||Je[Ve]===t)}(c)){for(r=F(t.length);h<r;h++)if((l=e?u(f(s=t[h])[0],s[1]):u(t[h]))===p||l===d)return l}else for(a=c.call(t);!(s=a.next()).done;)if((l=Me(a,u,s.value,e))===p||l===d)return l};e.BREAK=p,e.RETURN=d}),Ze=U("species"),Ye=g.process,Xe=g.setImmediate,ti=g.clearImmediate,ei=g.MessageChannel,ii=g.Dispatch,ni=0,oi={},ri="onreadystatechange";Xe&&ti||(Xe=function(t){for(var e=[],i=1;i<arguments.length;)e.push(arguments[i++]);return oi[++ni]=function(){!function(t,e,i){var n=void 0===i;switch(e.length){case 0:return n?t():t.call(i);case 1:return n?t(e[0]):t.call(i,e[0]);case 2:return n?t(e[0],e[1]):t.call(i,e[0],e[1]);case 3:return n?t(e[0],e[1],e[2]):t.call(i,e[0],e[1],e[2]);case 4:return n?t(e[0],e[1],e[2],e[3]):t.call(i,e[0],e[1],e[2],e[3])}t.apply(i,e)}("function"==typeof t?t:Function(t),e)},Be(ni),ni},ti=function(t){delete oi[t]},"process"==L(Ye)?Be=function(t){Ye.nextTick(y($e,t,1))}:ii&&ii.now?Be=function(t){ii.now(y($e,t,1))}:ei?(Ue=(Ne=new ei).port2,Ne.port1.onmessage=De,Be=y(Ue.postMessage,Ue,1)):g.addEventListener&&"function"==typeof postMessage&&!g.importScripts?(Be=function(t){g.postMessage(t+"","*")},g.addEventListener("message",De,!1)):Be=ri in n("script")?function(t){te.appendChild(n("script"))[ri]=function(){te.removeChild(this),$e.call(t)}}:function(t){setTimeout(y($e,t,1),0)});var si={set:Xe,clear:ti},ai=si.set,li=g.MutationObserver||g.WebKitMutationObserver,ci=g.process,ui=g.Promise,hi="process"==L(ci);function pi(t){var i,n;this.promise=new t(function(t,e){if(void 0!==i||void 0!==n)throw TypeError("Bad Promise constructor");i=t,n=e}),this.resolve=s(i),this.reject=s(n)}function di(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}}var fi={f:function(t){return new pi(t)}},yi=g.navigator,gi=yi&&yi.userAgent||"",mi=U("iterator"),vi=!1;try{[7][mi]().return=function(){vi=!0}}catch(t){}function bi(){}function wi(t){var e;return!(!r(t)||"function"!=typeof(e=t.then))&&e}function ki(u,i){if(!u._n){u._n=!0;var n=u._c;Li(function(){for(var l=u._v,c=1==u._s,t=0,e=function(t){var e,i,n,o=c?t.ok:t.fail,r=t.resolve,s=t.reject,a=t.domain;try{o?(c||(2==u._h&&Di(u),u._h=1),!0===o?e=l:(a&&a.enter(),e=o(l),a&&(a.exit(),n=!0)),e===t.promise?s(_i("Promise-chain cycle")):(i=wi(e))?i.call(e,r,s):r(e)):s(l)}catch(t){a&&!n&&a.exit(),s(t)}};n.length>t;)e(n[t++]);u._c=[],u._n=!1,i&&!u._h&&Mi(u)})}}function xi(t){var e=this;e._d||(e._d=!0,(e=e._w||e)._v=t,e._s=2,e._a||(e._a=e._c.slice()),ki(e,!0))}var Si,Ci,Oi,Ai,ji=si.set,Li=function(){function t(){var t,e;for(hi&&(t=ci.domain)&&t.exit();i;){e=i.fn,i=i.next;try{e()}catch(t){throw i?o():n=void 0,t}}n=void 0,t&&t.enter()}var i,n,o;if(hi)o=function(){ci.nextTick(t)};else if(!li||g.navigator&&g.navigator.standalone)if(ui&&ui.resolve){var e=ui.resolve(void 0);o=function(){e.then(t)}}else o=function(){ai.call(g,t)};else{var r=!0,s=document.createTextNode("");new li(t).observe(s,{characterData:!0}),o=function(){s.data=r=!r}}return function(t){var e={fn:t,next:void 0};n&&(n.next=e),i||(i=e,o()),n=e}}(),qi="Promise",_i=g.TypeError,Ii=g.process,Fi=Ii&&Ii.versions,Ti=Fi&&Fi.v8||"",Ei=g[qi],Ri="process"==Ge(Ii),Pi=Ci=fi.f,Gi=!!function(){try{var t=Ei.resolve(1),e=(t.constructor={})[U("species")]=function(t){t(bi,bi)};return(Ri||"function"==typeof PromiseRejectionEvent)&&t.then(bi)instanceof e&&0!==Ti.indexOf("6.6")&&-1===gi.indexOf("Chrome/66")}catch(t){}}(),Mi=function(r){ji.call(g,function(){var t,e,i,n=r._v,o=$i(r);if(o&&(t=di(function(){Ri?Ii.emit("unhandledRejection",n,r):(e=g.onunhandledrejection)?e({promise:r,reason:n}):(i=g.console)&&i.error&&i.error("Unhandled promise rejection",n)}),r._h=Ri||$i(r)?2:1),r._a=void 0,o&&t.e)throw t.v})},$i=function(t){return 1!==t._h&&0===(t._a||t._c).length},Di=function(e){ji.call(g,function(){var t;Ri?Ii.emit("rejectionHandled",e):(t=g.onrejectionhandled)&&t({promise:e,reason:e._v})})},Bi=function(t){var i,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===t)throw _i("Promise can't be resolved itself");(i=wi(t))?Li(function(){var e={_w:n,_d:!1};try{i.call(t,y(Bi,e,1),y(xi,e,1))}catch(t){xi.call(e,t)}}):(n._v=t,n._s=1,ki(n,!1))}catch(t){xi.call({_w:n,_d:!1},t)}}};function Ni(i,n){$(document).trigger("afd:getCountriesStart");var o,r=$(i),t=new Promise(function(t){o=t});return function(t){var e=Fe(t,{data:"list",task:"listcountries",fields:"standard"});return $.ajax(e)}(n).done(function(t){var e=t.Item;$.each(e,function(){1<n.typeahead.availableCountries.length?-1<n.typeahead.availableCountries.indexOf(this.iso)&&r.append($("<option />").val(this.iso).text(this.name)):r.append($("<option />").val(this.iso).text(this.name))}),n.defaultCountry&&(r.val(n.defaultCountry),$(document).trigger("afd:countryChanged",[i.val()])),$(document).trigger("afd:getCountriesComplete",e),o()}),i.change(function(){$(document).trigger("afd:countryChanged",[i.val()])}),t}Gi||(Ei=function(t){!function(t,e,i,n){if(!(t instanceof e)||void 0!==n&&n in t)throw TypeError(i+": incorrect invocation!")}(this,Ei,qi,"_h"),s(t),Si.call(this);try{t(y(Bi,this,1),y(xi,this,1))}catch(t){xi.call(this,t)}},(Si=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=function(t,e,i){for(var n in e)O(t,n,e[n],i);return t}(Ei.prototype,{then:function(t,e){var i=Pi(function(t,e){var i,n=f(t).constructor;return void 0===n||null==(i=f(n)[Ze])?e:s(i)}(this,Ei));return i.ok="function"!=typeof t||t,i.fail="function"==typeof e&&e,i.domain=Ri?Ii.domain:void 0,this._c.push(i),this._a&&this._a.push(i),this._s&&ki(this,!1),i.promise},catch:function(t){return this.then(void 0,t)}}),Oi=function(){var t=new Si;this.promise=t,this.resolve=y(Bi,t,1),this.reject=y(xi,t,1)},fi.f=Pi=function(t){return t===Ei||t===Ai?new Oi(t):Ci(t)}),E(E.G+E.W+E.F*!Gi,{Promise:Ei}),Wt(Ei,qi),gt(qi),Ai=m[qi],E(E.S+E.F*!Gi,qi,{reject:function(t){var e=Pi(this);return(0,e.reject)(t),e.promise}}),E(E.S+E.F*!Gi,qi,{resolve:function(t){return function(t,e){if(f(t),r(e)&&e.constructor===t)return e;var i=fi.f(t);return(0,i.resolve)(e),i.promise}(this,t)}}),E(E.S+E.F*!(Gi&&function(t,e){if(!e&&!vi)return!1;var i=!1;try{var n=[7],o=n[mi]();o.next=function(){return{done:i=!0}},n[mi]=function(){return o},t(n)}catch(t){}return i}(function(t){Ei.all(t).catch(bi)})),qi,{all:function(t){var s=this,e=Pi(s),a=e.resolve,l=e.reject,i=di(function(){var n=[],o=0,r=1;Ke(t,!1,function(t){var e=o++,i=!1;n.push(void 0),r++,s.resolve(t).then(function(t){i||(i=!0,n[e]=t,--r||a(n))},l)}),--r||a(n)});return i.e&&l(i.v),e.promise},race:function(t){var e=this,i=Pi(e),n=i.reject,o=di(function(){Ke(t,!1,function(t){e.resolve(t).then(i.resolve,n)})});return o.e&&n(o.v),i.promise}});var Ui,Hi={pceUrl:"//pce.afd.co.uk/afddata.pce",nativeValidationMessages:!1,defaultCountry:null,afdc:0,phone:{defaultDialingCode:"+44",invalidPhoneNumberMessage:"Please input a valid phone number"},email:{invalidEmailMessage:"Please input a valid email address"},card:{invalidCardNumberMessage:"Please input a valid card number",invalidCardOrExpiryMessage:"Either the card number or expiry date are not valid",invalidExpiryMonthMessage:"Please input a valid month",invalidExpiryDateMessage:"Please input a valid expiry date"},account:{invalidAccountNumberMessage:"Please input a valid account number",invalidSortCodeMessage:"Please input a valid Sort Code"},typeahead:{maxItems:5,pushUp:!1,afterHideTypeahead:!1,searchAgain:!0,afterClearTypeahead:!0,beforeHideResults:!1,parentClass:null,manualInputButton:!1,fewResultsManualInput:!0,fewResultsManualInputText:"Can't see your address? Enter it manually",notEmptyShowResults:!1,hideEmpties:!1,fieldSets:[],containers:[],retrieveFields:"standard",availableCountries:[],minLength:2,highlightMatches:!1,postcodeFirst:!0}},Qi=["country"];function Vi(){!function(){var t=[];if($("[data-afd-control]").each(function(){var i=$(this),n=i.data("afd-control");-1<Qi.indexOf(n)&&t.push(new Promise(function(t,e){Ji(i,n,t)}))}),Promise.all(t).then(function(){$("[data-afd-control]").each(function(){var t=$(this),e=t.data("afd-control");-1===Qi.indexOf(e)&&Ji(t,e)})}),0===t.length){if($("[data-afd-control]").length<1)return;$("[data-afd-control]").each(function(){var t=$(this),e=t.data("afd-control");-1===Qi.indexOf(e)&&Ji(t,e)})}}()}function Ji(t,e,i){if(!0!==t.data("afdInit"))try{t.afd(e,i)}catch(t){console.log(t)}}(Ui=t).fn.afd=function(i,n){return this.each(function(){var t=Ui(this);t.data("afdInit",!0);var e=Ui.extend(!0,{},Hi,afdOptions);"country"===i?Ni(t,e).then(function(){n()}):Te(t,e)})},Ui(document).ready(function(){Ui(document).trigger("afd::page_ready")}),void 0===window.$&&(window.$=Ui),Ui(document).on("afd::page_ready",function(){Vi()})});

